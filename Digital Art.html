<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Digital Art — Detail Project</title>
  <style>
    :root{--accent:#ff9800;--muted:#9aa4b2}
    *{box-sizing:border-box} body{margin:0;font-family:Inter, system-ui, Arial;background:#071018;color:#eaf0f6}
    .topbar{background:linear-gradient(180deg,#07101b,#041018);padding:12px 16px;position:sticky;top:0;border-bottom:1px solid rgba(255,255,255,0.03)}
    .topbar a{color:var(--muted);text-decoration:none;font-weight:600}
    .container{max-width:1000px;margin:28px auto;padding:0 16px}
    h1{color:var(--accent);margin:0 0 8px}
    .meta{color:var(--muted);margin-bottom:18px}
    .slider{position:relative;border-radius:10px;overflow:hidden;background:#08121a}
    .slides{display:flex;transition:transform .45s ease}
    .slides img{width:100%;height:520px;object-fit:contain;flex-shrink:0}
    .nav-btn{position:absolute;top:50%;transform:translateY(-50%);background:rgba(0,0,0,0.45);border:none;color:#fff;padding:10px 12px;border-radius:8px;cursor:pointer}
    .nav-btn.prev{left:12px} .nav-btn.next{right:12px}
    .thumbs{display:flex;gap:8px;margin-top:12px;overflow-x:auto;padding:8px 4px;scroll-behavior:smooth;scrollbar-width:thin;scrollbar-color:var(--accent) rgba(255,255,255,0.05)}
    .thumbs::-webkit-scrollbar{height:6px}
    .thumbs::-webkit-scrollbar-track{background:rgba(255,255,255,0.05);border-radius:3px}
    .thumbs::-webkit-scrollbar-thumb{background-color:var(--accent);border-radius:3px}
    .thumbs img{width:120px;height:70px;object-fit:cover;border-radius:6px;cursor:pointer;opacity:0.7;border:2px solid transparent;transition:opacity .3s,transform .3s,border-color .3s}
    .thumbs img:hover{opacity:1;transform:scale(1.05)}
    .thumbs img.active{opacity:1;border-color:var(--accent);transform:scale(1.05)}
    .content{display:flex;gap:24px;margin-top:20px;flex-wrap:wrap}
    .desc{flex:1;min-width:280px}
    .info{width:300px;min-width:220px;background:linear-gradient(180deg,#081218,#051018);padding:12px;border-radius:8px}
    .back{display:inline-block;margin-top:16px;padding:10px 14px;border-radius:8px;background:var(--accent);color:#071018;text-decoration:none;font-weight:700}
    @media(max-width:700px){ .slides img{height:320px} .thumbs img{width:90px;height:60px} .info{width:100%} .content{flex-direction:column} }
  </style>
</head>
<body>
  <div class="topbar"><a href="index.html">&#8592; Kembali ke Portofolio</a></div>
  <main class="container">
    <h1>Digital Art — Ilustrasi Digital dan Painting</h1>
    <div class="meta">Tools: Photoshop, Wacom Tablet, Digital Painting Software</div>

    <div class="skill-progress" id="skillProgress" style="margin-bottom:18px;">
      <h3 style="color:var(--accent);margin:0 0 8px">Skill Progress</h3>
      <div style="background:#08121a;border-radius:8px;padding:8px;">
        <div style="display:flex;justify-content:space-between;margin-bottom:4px;">
          <span style="color:#eaf0f6;">Digital Art Skill</span>
          <span id="skillPercent" style="color:var(--accent);font-weight:700;">0%</span>
        </div>
        <div style="background:#041018;border-radius:4px;height:12px;overflow:hidden;">
          <div id="progressBar" style="background:linear-gradient(90deg,var(--accent),#ffb74d);height:100%;width:0%;transition:width 1s ease;"></div>
        </div>
      </div>
    </div>

    <div class="slider" id="slider">
      <div class="slides" id="slides">
        <!-- Karya yang di-upload akan muncul di sini -->
      </div>
      <button class="nav-btn prev" id="prev">&#10094;</button>
      <button class="nav-btn next" id="next">&#10095;</button>
    </div>

    <div class="thumbs" id="thumbs">
      <!-- Thumbnails akan muncul di sini -->
    </div>

    <div class="content">
      <div class="desc">
        <h2>Deskripsi Project</h2>
        <p>Project digital art ini mencakup berbagai teknik digital painting dan ilustrasi. Saya menggunakan tablet Wacom untuk membuat karya seni digital yang kreatif dan ekspresif.</p>
        <p>Langkah kerja: sketch → line art → coloring → shading → final touches.</p>
        <a class="back" href="index.html">Kembali ke Portofolio</a>
      </div>
      <aside class="info">
        <h3 style="margin:0 0 8px">Detail Cepat</h3>
        <p style="margin:6px 0;color:var(--muted)"><strong>Software:</strong> Photoshop, Digital Painting Apps</p>
        <p style="margin:6px 0;color:var(--muted)"><strong>Peran:</strong> Digital Artist (painting, illustration)</p>
        <p style="margin:6px 0;color:var(--muted)"><strong>Status:</strong> Selesai</p>
      </aside>
    </div>
  </main>

  <script>
  (function(){
    // sesuaikan nama app sesuai value di upload.html dropdown
    const APP_KEY = 'digitalart'; // <-- ganti 'blender' pada blender.html, 'zbrush' pada zbrush.html, dsb.

    function getUploads(){ try{ return JSON.parse(localStorage.getItem('portfolio_uploads') || '[]') }catch(e){return []} }
    function saveUploads(arr){ localStorage.setItem('portfolio_uploads', JSON.stringify(arr)) }
    function getSkillSummary(){ try{ return JSON.parse(localStorage.getItem('skill_summary') || '{}') }catch(e){return {}} }

    let currentIndex = 0; // Tambahkan deklarasi currentIndex di sini

    // Helper function to animate number counting up (duplicated from index.html)
    function animateValue(obj, start, end, duration) {
      let startTimestamp = null;
      const step = (timestamp) => {
        if (!startTimestamp) startTimestamp = timestamp;
        const progress = Math.min((timestamp - startTimestamp) / duration, 1);
        const currentValue = Math.floor(progress * (end - start) + start);
        obj.innerHTML = currentValue + '%';
        if (progress < 1) {
          window.requestAnimationFrame(step);
        }
      };
      window.requestAnimationFrame(step);
    }
    const slidesEl = document.getElementById('slides');
    const thumbsContainer = document.getElementById('thumbs');
    const summary = getSkillSummary();
    const appSummary = summary[APP_KEY];

    // Update progress bar
    const skillPercentEl = document.getElementById('skillPercent');
    const progressBarEl = document.getElementById('progressBar');
    const currentAvg = appSummary ? appSummary.average : 0;
    if(skillPercentEl && progressBarEl && appSummary){
      progressBarEl.style.width = currentAvg + '%'; // CSS transition akan menangani animasi
      animateValue(skillPercentEl, 0, currentAvg, 900); // Animasikan angka dari 0 ke rata-rata saat ini
    }

    const uploads = getUploads();
    const myUploads = uploads.filter(u=>u.app === APP_KEY);

    let galleryItems = [];

    // 1. Get static items from the DOM
    const staticSlides = Array.from(slidesEl.querySelectorAll('img'));
    staticSlides.forEach((img, i) => {
      galleryItems.push({
        id: `static_${i}`, isStatic: true, imageData: img.src, description: img.alt, app: APP_KEY
      });
    });

    // 2. Prepend dynamic uploads to the gallery items
    galleryItems = [...myUploads, ...galleryItems];

    // 3. Render the unified gallery
    function renderGallery() {
      slidesEl.innerHTML = '';
      thumbsContainer.innerHTML = '';

      if (galleryItems.length === 0) {
        slidesEl.innerHTML = '<p style="text-align:center; padding: 2rem; color: var(--muted);">Belum ada karya yang diunggah untuk kategori ini.</p>';
        return;
      }

      galleryItems.forEach((item, i) => {
        const isVideo = item.imageData.startsWith('data:video');
        let slideEl;
        if (isVideo) {
          slideEl = document.createElement('video');
          slideEl.controls = true; slideEl.muted = true;
          slideEl.style.cssText = 'width:100%; height:520px; object-fit:contain;';
        } else {
          slideEl = document.createElement('img');
        }
        slideEl.src = item.imageData;
        slideEl.alt = item.description || 'Karya';
        slidesEl.appendChild(slideEl);

        const thumbEl = document.createElement('img');
        thumbEl.src = isVideo ? 'https://via.placeholder.com/120x70.png?text=Video' : item.imageData;
        thumbEl.dataset.index = i;
        thumbEl.style.position = 'relative';
        thumbEl.addEventListener('click', () => { currentIndex = i; updateSlider(); });
        thumbsContainer.appendChild(thumbEl);

        if (!item.isStatic) {
          const deleteBtn = document.createElement('button');
          deleteBtn.innerHTML = '&times;';
          deleteBtn.title = 'Hapus karya ini';
          deleteBtn.style.cssText = 'position:absolute; top:-5px; right:-5px; background:#f44336; color:white; border:none; border-radius:50%; width:20px; height:20px; cursor:pointer; z-index:10;';
          deleteBtn.onclick = (e) => {
            e.stopPropagation();
            if (confirm('Anda yakin ingin menghapus karya ini?')) {
              const allUploads = getUploads();
              const newUploads = allUploads.filter(up => up.id !== item.id);
              saveUploads(newUploads);
              galleryItems.splice(i, 1);
              if (currentIndex >= galleryItems.length) {
                currentIndex = Math.max(0, galleryItems.length - 1);
              }
              renderGallery();
              updateSlider();
            }
          };
          thumbEl.appendChild(deleteBtn);
        }
      });
    }

    function updateSlider() {
      if (galleryItems.length === 0) return;
      slidesEl.style.transform = `translateX(-${currentIndex * 100}%)`;
      const allThumbs = thumbsContainer.querySelectorAll('img');
      allThumbs.forEach(t => t.classList.remove('active'));
      if (allThumbs[currentIndex]) {
        allThumbs[currentIndex].classList.add('active');
        allThumbs[currentIndex].scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
      }
      // Update background
      const currentItem = galleryItems[currentIndex];
      const sliderBg = document.getElementById('sliderBg');
      if (sliderBg && currentItem && !currentItem.imageData.startsWith('data:video')) {
        sliderBg.style.backgroundImage = `url('${currentItem.imageData}')`;
      } else if (sliderBg) {
        sliderBg.style.backgroundImage = 'none'; // No background for videos
      }
    }

    renderGallery();
    updateSlider();

    document.getElementById('next').addEventListener('click', () => {
      if (galleryItems.length === 0) return;
      currentIndex = (currentIndex + 1) % galleryItems.length;
      updateSlider();
    });
    document.getElementById('prev').addEventListener('click', () => {
      if (galleryItems.length === 0) return;
      currentIndex = (currentIndex - 1 + galleryItems.length) % galleryItems.length;
      updateSlider();
    });
    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowRight') document.getElementById('next').click();
      if (e.key === 'ArrowLeft') document.getElementById('prev').click();
    });
  })();
  </script>
</body>
</html>
